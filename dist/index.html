<!DOCTYPE html>
<html lang="he" dir="rtl" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>住驻专 转 砖</title>
  <meta name="description" content="住驻专 转  - 砖专,  驻砖 转 转 砖">
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#a7f3d0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="转">
  
  <!-- Favicon and Icons -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'></text></svg>">
  <link rel="apple-touch-icon" href="/icons/icon-152x152.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png">
  <link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png">
  <link rel="apple-touch-icon" sizes="128x128" href="/icons/icon-128x128.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png">
  <link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png">
  <link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
  
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#a7f3d0", // Pale Mint
            "primary-hover": "#6ee7b7",
            "secondary": "#fda4af", // Soft Peach/Pink
            "accent": "#c4b5fd", // Lavender
            "background-light": "#fdfbf7", // Warm off-white
            "background-dark": "#0f172a", 
            "card-dark": "#1e293b",
            "card-light": "#ffffff",
          },
          fontFamily: {
            display: ["Outfit", "sans-serif"],
          },
          boxShadow: {
            'glow': '0 0 25px -5px rgba(167, 243, 208, 0.6)', 
            'glow-teal': '0 0 20px -5px rgba(45, 212, 191, 0.5)',
            'glow-hover': '0 0 35px -5px rgba(167, 243, 208, 0.8)',
            'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)',
            'soft': '0 10px 40px -10px rgba(0,0,0,0.08)',
            'glow-ai': '0 0 25px -5px rgba(196, 181, 253, 0.8)',
          },
          animation: {
            'float': 'float 6s ease-in-out infinite',
            'blob': 'blob 10s infinite',
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-10px)' },
            },
            blob: {
              "0%": { transform: "translate(0px, 0px) scale(1)" },
              "33%": { transform: "translate(30px, -50px) scale(1.1)" },
              "66%": { transform: "translate(-20px, 20px) scale(0.9)" },
              "100%": { transform: "translate(0px, 0px) scale(1)" }
            }
          }
        },
      },
    };
  </script>
  
  <!-- Custom Styles (?v= forces browser to load latest in dev) -->


  
  <script>
    // Dark mode toggle
    function toggleDarkMode() {
      document.documentElement.classList.toggle('dark');
      localStorage.setItem('darkMode', document.documentElement.classList.contains('dark'));
    }
    
    // Load dark mode preference
    if (localStorage.getItem('darkMode') === 'true') {
      document.documentElement.classList.add('dark');
    }
  </script>
  <script type="module" crossorigin src="/assets/index-D8OSu-a0.js"></script>
  <link rel="stylesheet" crossorigin href="/assets/index-QABIWTf4.css">
<link rel="manifest" href="/manifest.webmanifest"><script id="vite-plugin-pwa:register-sw" src="/registerSW.js"></script></head>
<body class="bg-background-light dark:bg-background-dark text-slate-800 dark:text-slate-100 font-display transition-colors duration-500 min-h-screen relative selection:bg-primary selection:text-slate-900">
  <!-- Animated Blobs -->
  <div class="blob-1"></div>
  <div class="blob-2"></div>
  <div class="blob-3"></div>
  
  <header class="header glass-panel">
    <h1>
      <div class="header-logo-icon">
        <span class="material-symbols-outlined">restaurant_menu</span>
      </div>
      住驻专 <span class="header-logo-gradient">转</span>
    </h1>
    <!-- Search Bar in Header -->
    <div class="header-search-container">
      <div class="header-search-wrapper">
        <span class="material-symbols-outlined header-search-icon">search</span>
        <input type="text" id="searchName" class="header-search-input" placeholder="驻砖 转..." oninput="filterRecipes()">
        <span class="material-symbols-outlined header-filter-icon" onclick="toggleFilterPanel()" title="驻转/住专 住">tune</span>
      </div>
    </div>
    <div class="header-controls">
      <button onclick="toggleDarkMode()" class="header-btn" title="爪 /专">
        <span class="material-symbols-outlined dark:hidden">dark_mode</span>
        <span class="material-symbols-outlined hidden dark:block" style="color: var(--primary-color);">light_mode</span>
      </button>
      <!-- Timer Widget - Collapsible -->
      <div class="timer-widget" id="timer-widget">
        <button id="timer-toggle-btn" class="timer-toggle-btn" title="专">
          <span class="material-symbols-outlined timer-icon">timer</span>
          <span class="timer-mini-display" id="timer-mini-display"></span>
        </button>
        <div class="timer-expanded" id="timer-expanded">
          <div class="timer-expanded-header">
            <span class="timer-title">专 砖</span>
            <button id="timer-close-btn" class="timer-close-btn" title="住专">
              <span class="material-symbols-outlined">close</span>
            </button>
          </div>
          <div class="timer-content">
            <div class="timer-display-large" id="timer-display"></div>
            <div class="timer-input-group">
              <div class="timer-input-wrapper">
                <input type="number" id="timer-hours" min="0" max="99" step="1" value="0" class="timer-input" placeholder="0">
                <span class="timer-input-label">砖注转</span>
              </div>
              <span class="timer-separator">:</span>
              <div class="timer-input-wrapper">
                <input type="number" id="timer-minutes" min="0" max="59" step="1" value="1" class="timer-input" placeholder="0">
                <span class="timer-input-label">拽转</span>
              </div>
              <span class="timer-separator">:</span>
              <div class="timer-input-wrapper">
                <input type="number" id="timer-seconds" min="0" max="59" step="1" value="0" class="timer-input" placeholder="0">
                <span class="timer-input-label">砖转</span>
              </div>
            </div>
            <div class="timer-controls">
              <button id="start-timer" class="timer-action-btn timer-start" title="转">
                <span class="material-symbols-outlined">play_arrow</span>
                <span>转</span>
              </button>
              <button id="pause-timer" class="timer-action-btn timer-pause" title="砖" style="display: none;">
                <span class="material-symbols-outlined">pause</span>
                <span>砖</span>
              </button>
              <button id="stop-timer" class="timer-action-btn timer-stop" title="注爪专" style="display: none;">
                <span class="material-symbols-outlined">stop</span>
                <span>注爪专</span>
              </button>
            </div>
            <div class="timer-volume-row">
              <label for="timer-volume" class="timer-volume-label">
                <span class="material-symbols-outlined timer-volume-icon">volume_up</span>
                注爪转 爪
              </label>
              <input type="range" id="timer-volume" class="timer-volume-slider" min="0" max="100" value="80" step="1" title="注爪转 爪 转专">
              <span class="timer-volume-value" id="timer-volume-value">80%</span>
            </div>
            <div class="timer-presets">
              <span class="timer-presets-label"> 专:</span>
              <div class="timer-presets-grid">
                <button class="preset-btn" data-time="300">5 拽壮</button>
                <button class="preset-btn" data-time="600">10 拽壮</button>
                <button class="preset-btn" data-time="900">15 拽壮</button>
                <button class="preset-btn" data-time="1800">30 拽壮</button>
                <button class="preset-btn" data-time="2700">45 拽壮</button>
                <button class="preset-btn" data-time="3600">砖注</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Hidden file input for JSON import -->
  <input type="file" id="importJson" accept=".json" style="display: none;" onchange="importRecipes(event)">

  <main class="main">
    <!-- Filter Panel -->
    <div class="main-filter-panel" id="searchContainer" style="display: none;">
      <div class="filter-panel-header">
        <span class="filter-results" id="filterResultsCount"></span>
        <button type="button" class="clear-filters-btn is-hidden" id="clearFiltersBtn" onclick="resetSearch()">拽 </button>
      </div>
      <div class="search-filters-row">
        <div class="search-filter-item">
          <span class="material-symbols-outlined search-filter-icon">shopping_basket</span>
          <input type="text" id="searchIngredients" class="search-filter-input" placeholder="驻砖 驻 爪专" oninput="filterRecipes()">
        </div>
        <div class="search-filter-item">
          <span class="material-symbols-outlined search-filter-icon">schedule</span>
          <input type="number" id="searchPrepTime" class="search-filter-input" placeholder="  (拽转)" min="0" oninput="filterRecipes()">
        </div>
        <div class="search-filter-item">
          <span class="material-symbols-outlined search-filter-icon">restaurant</span>
          <select id="searchDietaryType" class="search-filter-input" onchange="filterRecipes()">
            <option value=""> (/砖专/驻专)</option>
            <option value=""></option>
            <option value="砖专">砖专</option>
            <option value="驻专">驻专</option>
          </select>
        </div>
        <div class="search-filter-item">
          <span class="material-symbols-outlined search-filter-icon">star</span>
          <div class="filter-rating" id="filterRating"></div>
        </div>
      </div>
    </div>
    <!-- Category Filter Buttons Row -->
    <div class="category-filter-row">
      <div class="category-filter" id="categoryFilter">
        <!-- 驻转专 拽专转 转住驻 转 -->
      </div>
    </div>
    
    <!-- Grid Selector (Fixed Position) -->
    <div class="grid-selector-wrapper">
      <button id="grid-selector-btn" class="grid-selector-btn" title="转 砖专" onclick="toggleGridSelector()">
        <span class="material-symbols-outlined">grid_view</span>
      </button>
      <div id="grid-selector-menu" class="grid-selector-menu" style="display: none;">
        <button class="grid-option" data-cols="4">4 砖专</button>
        <button class="grid-option" data-cols="5">5 砖专</button>
        <button class="grid-option" data-cols="6">6 砖专</button>
        <button class="grid-option" data-cols="7">7 砖专</button>
      </div>
    </div>
    
    
    <div class="recipes-container" id="recipesContainer"></div>
  </main>

  <!--  转 -->
  <div class="popup-overlay" id="popup">
    <div class="popup-content">
      <div id="popupBody"></div>
    </div>
  </div>

  <!--  住驻转 转 -->
  <div class="popup-overlay" id="formPopup" style="display: none;">
    <div class="form-popup-content form-add-recipe">
      <button class="close-btn" onclick="closeFormPopup()">&times;</button>

      <header class="form-add-recipe-header">
        <div class="form-add-recipe-header-title-wrap">
          <div class="form-add-recipe-header-icon" aria-hidden="true">
            <span class="material-symbols-outlined">restaurant_menu</span>
          </div>
          <h2 class="form-add-recipe-title">住驻转 转 砖</h2>
        </div>
        <div class="form-add-recipe-header-actions">
          <button type="button" class="form-add-recipe-dark-btn" onclick="toggleDarkMode()" title="爪 ">
            <span class="material-symbols-outlined">dark_mode</span>
          </button>
          <button type="submit" form="recipeForm" class="form-add-recipe-save-btn">
            <span>砖专转 转</span>
            <span class="material-symbols-outlined">save</span>
          </button>
        </div>
      </header>

      <form id="recipeForm" class="form-add-recipe-grid">
        <input type="hidden" id="formRating" value="0">

        <div class="form-add-recipe-main">
          <section class="form-add-recipe-card form-add-recipe-section-basics">
            <div class="form-add-recipe-basics">
              <input type="text" id="recipeName" class="form-add-recipe-input" placeholder="砖 转" aria-label="砖 转" required style="border: 1px solid #cbd5e1;">
              <input type="text" id="recipeSource" class="form-add-recipe-input" placeholder="拽专 转" aria-label="拽专 转" style="border: 1px solid #cbd5e1;">
            </div>
          </section>

          <!-- 3. 爪专 + 4. 砖  -->
          <div class="form-add-recipe-ingredients-instructions-row">
            <section class="form-add-recipe-card">
              <div class="form-add-recipe-section-head form-add-recipe-section-head-single">
                <span class="form-add-recipe-step-num form-add-recipe-step-num-small" aria-hidden="true">3</span>
                <span class="material-symbols-outlined form-add-recipe-section-icon">shopping_basket</span>
                <h3 class="form-add-recipe-section-title">爪专</h3>
              </div>
              <textarea id="ingredients" class="form-add-recipe-block-textarea" placeholder="专砖  转  爪专,  爪专 砖专 砖  驻住拽...&#10;砖: 2 驻转 砖 转, 爪  拽爪抓 拽"></textarea>
            </section>
            <section class="form-add-recipe-card">
              <div class="form-add-recipe-section-head form-add-recipe-section-head-single">
                <span class="form-add-recipe-step-num form-add-recipe-step-num-small" aria-hidden="true">4</span>
                <span class="material-symbols-outlined form-add-recipe-section-icon">format_list_numbered</span>
                <h3 class="form-add-recipe-section-title">砖 </h3>
              </div>
              <textarea id="instructions" class="form-add-recipe-block-textarea" placeholder="专砖  转 砖 ...&#10;砖:  砖 转 转.  爪 注 砖 专 砖拽祝."></textarea>
            </section>
          </div>

          <section class="form-add-recipe-card">
            <h3 class="form-add-recipe-sidebar-heading">注专转 驻</h3>
            <textarea id="notes" class="form-add-recipe-notes-input" placeholder=" 驻砖专 住祝 驻 , 注专转 注 转  爪注转 砖..." rows="1"></textarea>
          </section>
        </div>

        <div class="form-add-recipe-sidebar">
          <!-- 2. 转转 转 -->
          <section class="form-add-recipe-card form-add-recipe-section-attrs">
            <h3 class="form-add-recipe-section-heading-main">
              <span class="form-add-recipe-step-num" aria-hidden="true">2</span>
              <span class="material-symbols-outlined">tune</span>
              转转 转
            </h3>
            <div class="form-add-recipe-attr-cards">
              <div class="form-add-recipe-attr-card form-attr-time">
                <span class="form-attr-label"> </span>
                <div class="form-attr-time-inner">
                  <input type="number" id="preparationTime" class="form-attr-time-input" placeholder="30" min="0">
                  <span class="form-attr-unit">拽壮</span>
                </div>
                <span class="material-symbols-outlined form-attr-icon">schedule</span>
              </div>
              <div class="form-add-recipe-attr-card form-attr-difficulty">
                <span class="form-attr-label">专转 拽砖</span>
                <div class="form-difficulty-bars" id="formDifficultyBars" aria-hidden="true" role="group" aria-label="专转 拽砖">
                  <span class="form-diff-bar" data-level="1" title="拽"></span>
                  <span class="form-diff-bar" data-level="2" title=""></span>
                  <span class="form-diff-bar form-diff-empty" data-level="3" title="拽砖"></span>
                </div>
                <span class="form-difficulty-text" id="formDifficultyText"></span>
              </div>
              <div class="form-add-recipe-attr-card form-attr-category">
                <span class="form-attr-label">
                  <span class="material-symbols-outlined form-attr-label-icon-inline" aria-hidden="true">category</span>
                  拽专
                </span>
                <div class="form-category-inline">
                  <select id="category" class="form-add-recipe-select-inline">
                    <option value="" disabled selected>专转 拽专</option>
                  </select>
                  <button type="button" class="form-category-add-btn" onclick="toggleCategoryInput()" id="toggleNewCategory" title="拽专 砖">
                    <span class="material-symbols-outlined">add</span>
                  </button>
                </div>
                <input type="text" id="newCategory" class="form-add-recipe-input form-new-category-input" placeholder="砖 拽专 砖" style="display: none;">
              </div>
              <div class="form-add-recipe-attr-card form-attr-rating">
                <span class="form-attr-label">专</span>
                <div class="form-rating-stars" id="formRatingStars" aria-label="专 ">
                  <span class="form-star material-symbols-outlined" data-rating="1">star</span>
                  <span class="form-star material-symbols-outlined" data-rating="2">star</span>
                  <span class="form-star material-symbols-outlined" data-rating="3">star</span>
                  <span class="form-star material-symbols-outlined" data-rating="4">star</span>
                  <span class="form-star material-symbols-outlined" data-rating="5">star</span>
                </div>
              </div>
              <div class="form-add-recipe-attr-card form-attr-dietary">
                <span class="form-attr-label">
                  <span class="material-symbols-outlined form-attr-label-icon-inline" aria-hidden="true">restaurant</span>
                  住 转
                </span>
                <select id="dietaryType" class="form-add-recipe-select-inline">
                  <option value="" selected> 专</option>
                  <option value=""></option>
                  <option value="砖专">砖专</option>
                  <option value="驻专">驻专</option>
                </select>
              </div>
            </div>
          </section>

          <section class="form-add-recipe-card form-add-recipe-links-section">
            <h3 class="form-add-recipe-sidebar-heading">拽砖专 爪</h3>
            <div class="form-add-recipe-link-row">
              <span class="material-symbols-outlined form-add-recipe-link-icon form-add-recipe-link-yt">play_circle</span>
              <input type="url" id="recipeVideo" name="recipeVideo" class="form-add-recipe-link-input" placeholder="拽砖专 ">
            </div>
            <div class="form-add-recipe-link-row">
              <span class="material-symbols-outlined form-add-recipe-link-icon form-add-recipe-link-src">link</span>
              <input type="url" id="recipeLink" name="recipeLink" class="form-add-recipe-link-input" placeholder="拽 拽专">
            </div>
          </section>

          <section class="form-add-recipe-card form-add-recipe-upload-card">
            <input type="file" id="image" accept="image/*" style="display: none;" onchange="previewFormImage(event)">
            <input type="file" id="ocrImage" accept="image/*" onchange="processOCR(event)" style="display: none;">
            <div class="form-add-recipe-upload-zone image-upload-area" onclick="document.getElementById('image').click()">
              <div id="inlineImageUploadContent" class="form-add-recipe-upload-content image-upload-content">
                <span class="material-symbols-outlined form-add-recipe-upload-icon">cloud_upload</span>
                <p class="form-add-recipe-upload-title">专专 转 </p>
                <p class="form-add-recipe-upload-hint"> 抓 专转 拽抓</p>
              </div>
              <div id="inlineImagePreview" class="form-add-recipe-upload-preview" style="display: none;">
                <img id="inlinePreviewImg" src="" alt="转爪 拽">
              </div>
            </div>
            <div class="form-add-recipe-upload-btns">
              <button type="button" class="form-add-recipe-ocr-btn" onclick="document.getElementById('ocrImage').click()">
                <span class="material-symbols-outlined">document_scanner</span>
                住专拽 转 (OCR)
              </button>
              <button type="button" class="form-add-recipe-generate-image-btn" onclick="regenerateImageForForm()">
                <span class="material-symbols-outlined">image</span>
                爪专 转 砖
              </button>
            </div>
          </section>
        </div>
      </form>

      <button type="button" class="form-add-recipe-help-btn" onclick="openAiChat()" title="注专 住 转">
        <span class="material-symbols-outlined">help_outline</span>
      </button>
    </div>
  </div>

  <!-- 转专转  -->
  <div class="backup-reminder" id="backupReminder" style="display: none;">
    <span> !  转 转 转 砖   专.</span>
    <button onclick="closeBackupReminder()"></button>
  </div>

  <!-- 驻 爪' AI - 注爪 住专驻 专 -->
  <div class="ai-chat-overlay" id="aiChatOverlay" style="display: none;">
    <div class="ai-chat-container ai-chat-phone">
      <div class="ai-chat-panel">
        <!-- Header -->
        <div class="ai-chat-header">
          <div class="ai-chat-header-top">
            <div class="ai-chat-header-info">
              <div class="ai-chat-header-avatar">
                <img src="chef-serving.png" alt="砖祝" class="ai-chat-header-chef-img">
              </div>
              <div class="ai-chat-header-text">
                <h3>AI 注专 砖</h3>
                <div class="ai-chat-header-status">
                  <span class="status-dot"></span>
                  <span>专  注专</span>
                </div>
              </div>
            </div>
          </div>
          <!-- History Dropdown -->
          <div class="ai-chat-history-select-wrapper">
            <label>住专转 砖转</label>
            <div class="ai-chat-history-select">
              <select id="aiChatHistorySelect" onchange="loadSelectedConversation(this.value)">
                <option value="new">砖 砖 -  砖 ?</option>
              </select>
              <span class="material-symbols-outlined select-arrow">expand_more</span>
            </div>
          </div>
        </div>

        <!-- Messages -->
        <div class="ai-chat-messages" id="aiChatMessages"></div>

        <!-- Attachments Preview -->
        <div class="ai-chat-attachments" id="aiChatAttachments" style="display: none;"></div>

        <!-- Input Area -->
        <div class="ai-chat-input-area">
          <div class="ai-chat-input-row">
            <button type="button" id="aiChatAttach" onclick="document.getElementById('aiChatFileInput').click()" title="爪专祝 转">
              <span class="material-symbols-outlined">attach_file</span>
            </button>
            <input type="text" id="aiChatInput" placeholder="拽 ..." onkeydown="if(event.key==='Enter')sendAiMessage()">
            <button type="button" id="aiChatVoice" onclick="toggleVoiceRecording()" title="拽 拽">
              <span class="material-symbols-outlined">mic</span>
            </button>
            <button type="button" id="aiChatSend" onclick="sendAiMessage()" title="砖">
              <span class="material-symbols-outlined">send</span>
            </button>
            <input type="file" id="aiChatFileInput" accept="image/*" multiple style="display: none;" onchange="handleChatFileSelect(event)">
          </div>
          <p class="ai-chat-input-helper">-AI 注砖 爪注 砖 爪专转, 拽 转 转  砖.</p>
        </div>
      </div>
    </div>
  </div>

  <!--  砖专 拽 -->
  <div class="popup-overlay" id="confirmPopup" style="display: none;">
    <div class="confirm-popup-content">
      <h3> 专爪 拽 转 转?</h3>
      <button class="confirm" onclick="deleteRecipe()">拽</button>
      <button class="cancel" onclick="closeConfirmPopup()"></button>
    </div>
  </div>

  <!-- Floating Action Buttons -->
  <div class="floating-actions">
    <button class="floating-action-btn ai-chat" onclick="openAiChat()" title="砖 注 AI">
      <img src="chef-main.png" alt="砖祝" class="chat-btn-chef-icon">
    </button>
    <button class="floating-action-btn" onclick="openFormPopup()" title="住祝 转">
      <span class="material-symbols-outlined">add</span>
    </button>
  </div>

  <!-- 住驻专 爪转 -OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/tesseract.min.js"></script>

</body>
</html>
